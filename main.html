<!DOCTYPE html>
<!-- 
  This is the main HTML file for the Flanker Task experiment.
  It sets up the web page and loads all necessary code and styling to run the experiment.
-->
<html lang="en">

<head>
  <!-- These meta tags tell the browser how to display and interpret this page -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Experiment</title>
  <!-- written on jsPsych Version 8.2.3 -->

  <!-- ========== SECTION 1: LOAD STYLING (CSS) ========== -->
  <!-- CSS (Cascading Style Sheets) controls how things look on the page -->
  <link href="https://unpkg.com/jspsych@8.2.3/css/jspsych.css" rel="stylesheet" type="text/css">
  <!-- Above: Load the default jsPsych styling from the internet -->
  <link href="css/experimentStyle.css" rel="stylesheet" type="text/css">
  <!-- Above: Load our custom styling from the local css/ folder -->
  

  <!-- ========== SECTION 2: LOAD JSPSYCH LIBRARY ========== -->
    <script src="https://unpkg.com/jspsych@8.2.3"></script>

  <!-- ========== SECTION 3: LOAD JSPSYCH PLUGINS ========== -->
  <!-- Plugins are add-ons to jsPsych that create specific types of experimental trials -->
  <!-- Each script below adds a different trial type to the experiment -->
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.0.0"></script>
  <!-- Above: Plugin for showing text/images and recording keyboard responses -->
   <script src="https://unpkg.com/@jspsych/plugin-html-button-response@2.0.0"></script>
  <!-- Above: Plugin for showing text/images and recording button responses -->
  <script src="https://unpkg.com/@jspsych/plugin-instructions@2.0.0"></script>
  <!-- Above: Plugin for displaying instructions to participants -->
  <script src="https://unpkg.com/@jspsych/plugin-survey-text@2.0.0"></script>
  <!-- Above: Plugin for text input surveys  -->
  <script src="https://unpkg.com/@jspsych/plugin-survey-html-form@2.0.0"></script>
  <!-- Above: Plugin for form-based surveys with multiple question types -->
  <script src="https://unpkg.com/@jspsych/plugin-call-function@2.0.0"></script>
  <!-- Above: Plugin for running custom JavaScript functions during the experiment -->
  <script src="https://unpkg.com/@jspsych/plugin-browser-check@2.0.0"></script>
  <!-- Above: Plugin for checking browser compatibility -->
  <script src="https://unpkg.com/@jspsych/plugin-external-html@2.0.0"></script>
  <!-- Above: Plugin for loading external HTML files into the experiment -->


  <!-- ========== SECTION 4: LOAD EXTERNAL LIBRARIES ========== -->
  <!-- These are additional JavaScript libraries that provide useful functions -->
  <script src="https://unpkg.com/mathjs@13.2.0/lib/browser/math.js"></script>
  <!-- Above: Math library for mathematical operations -->


  <!-- ========== SECTION 5: LOAD WORKFLOW SCRIPTS ========== -->
  <!-- These scripts are custom files we created to define the experiment logic -->
  <script src="scripts/base_functions.js"></script>
  <!-- Above: Basic utility functions used throughout the experiment -->
  <script>loadScripts("scripts/", ["counterbalancing", "stimulus_helper", "instructions_reader"])</script>
  <!-- Above: Load multiple helper scripts from the scripts/ folder that handle:
       - counterbalancing: Assigning different stimulus orders to different participants
       - stimulus_helper: Some reoccuring trial parts such as feedback.
       - instructions_reader: Managing instruction text
       - functional_trials: Some special function "trials" (e.g. "Welcome to the experiment" or data storage) -->

  <!-- ========== SECTION 6: LOAD EXPERIMENT CONFIGURATION ========== -->
  <!-- These files contain settings, parameters and order for this specific experiment -->
  <script>loadScripts("input/", ["timeline_builder", "block_builder", "counterbalancing_parameter", "experiment_information", "functional_trials", "stimulus_constructor"])</script>
  <!-- Above: Load configuration files that define:
       - timeline_builder: Organizes all trials in the correct order
       - block_builder: Defines the creation of trial blocks.
       - counterbalancing_parameter: Parameters for counterbalancing.
       - experiment_information: General experiment settings (used keys, durations etc.).
       - stimulus_constructor: Translates trial conditions into the visual appearance of the stimulus. -->

  <!-- ========== SECTION 7: LOAD JATOS ========== -->
  <!-- JATOS (Just Another Tool for Online Studies) is the platform running this experiment -->
  <!-- It handles participant links, data collection, and storage -->
  <script src="jatos.js"></script>

</head>

<body id="experimentSurface">
  <!-- 
    The <body> section contains the visible page content and the core experiment code.
    id="experimentSurface" is a unique identifier that jsPsych uses to know where to display the experiment.
  -->
  <script>
    // These variables control skim mode and skipping to main experiment. Used for debugging/testing.
    // If you want to use these, create a new Jatos component that points init.html as file path and define componentInput JSON like:
    // {  "skimMode": true, "skipToMain": true }
    var skimMode = false;
    var skipToMain = false;
    var expInfo; // Global variable to hold experiment configuration
    
    // ========== INITIALIZE JSPSYCH AND TIMELINE ==========   

    var jsPsych = initJsPsych( 
      { 
        on_finish: () =>{
          jatos.endStudy();
        }
      }
    );
    // Above: Create the main jsPsych object that will control the entire experiment
    // The on_finish function tells jsPsych to call jatos.endStudy() when the experiment is finished, which will save the data and end the session in JATOS.
    
    var experimentTimeline = [];
    // Above: This array will hold all the trials and blocks that make up the experiment
    
    
    // ========== START THE EXPERIMENT ==========
    // jatos.onLoad() waits for JATOS to fully load before running this code
    jatos.onLoad(() => {
      // Read flags from JATOS componentInput
      if (jatos.componentInput) {
        console.log(jatos.componentInput);
        
        if (jatos.componentInput.skimMode !== undefined) {
          skimMode = jatos.componentInput.skimMode;
        }
        if (jatos.componentInput.skipToMain !== undefined) {
          skipToMain = jatos.componentInput.skipToMain;
        }
      }

      // Build the timeline: Get all the trials and blocks from timelineBuilder()
      // This is where the magic happens and where we define what the experiment actually looks like.
      // Continue in the file input/timelineBuilder.js to continue with the code flow.  
      experimentTimeline = timelineBuilder();

      // RUN THE EXPERIMENT: Tell jsPsych to start running all the trials in the timeline
      jsPsych.run(experimentTimeline);
    });
  </script>
</body>

</html>
